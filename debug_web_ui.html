<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web UI è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
    </style>
</head>
<body>
    <h1>ğŸ² DND è·‘å›¢ç®¡ç†å™¨ - Web UI è°ƒè¯•</h1>
    
    <div class="debug-section">
        <h2>API è¿æ¥æµ‹è¯•</h2>
        <button class="btn" onclick="testApiConnection()">æµ‹è¯• API è¿æ¥</button>
        <button class="btn" onclick="testGetCampaigns()">è·å–è·‘å›¢åˆ—è¡¨</button>
        <button class="btn" onclick="testCreateCampaign()">åˆ›å»ºæµ‹è¯•è·‘å›¢</button>
        <button class="btn" onclick="testDeleteCampaign()">åˆ é™¤æµ‹è¯•è·‘å›¢</button>
        <div id="apiResult" class="result"></div>
    </div>

    <div class="debug-section">
        <h2>JavaScript åŠŸèƒ½æµ‹è¯•</h2>
        <button class="btn" onclick="testBasicJS()">æµ‹è¯•åŸºç¡€ JavaScript</button>
        <button class="btn" onclick="testFetchAPI()">æµ‹è¯• Fetch API</button>
        <button class="btn" onclick="testDOMManipulation()">æµ‹è¯• DOM æ“ä½œ</button>
        <div id="jsResult" class="result"></div>
    </div>

    <div class="debug-section">
        <h2>é”™è¯¯æ—¥å¿—</h2>
        <button class="btn" onclick="clearErrorLog()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="errorLog" class="result"></div>
    </div>

    <script>
        // é”™è¯¯æ•è·
        window.addEventListener('error', function(e) {
            logError(`JavaScript Error: ${e.message} at ${e.filename}:${e.lineno}`);
        });

        window.addEventListener('unhandledrejection', function(e) {
            logError(`Unhandled Promise Rejection: ${e.reason}`);
        });

        function logError(message) {
            const errorLog = document.getElementById('errorLog');
            const timestamp = new Date().toLocaleTimeString();
            errorLog.innerHTML += `[${timestamp}] ${message}\n`;
            errorLog.className = 'result error';
        }

        function logSuccess(message) {
            const errorLog = document.getElementById('errorLog');
            const timestamp = new Date().toLocaleTimeString();
            errorLog.innerHTML += `[${timestamp}] âœ… ${message}\n`;
        }

        function clearErrorLog() {
            document.getElementById('errorLog').innerHTML = '';
            document.getElementById('errorLog').className = 'result';
        }

        // API æµ‹è¯•å‡½æ•°
        async function testApiConnection() {
            const result = document.getElementById('apiResult');
            result.innerHTML = 'æ­£åœ¨æµ‹è¯• API è¿æ¥...';
            
            try {
                const response = await fetch('/api/campaigns');
                if (response.ok) {
                    result.innerHTML = 'âœ… API è¿æ¥æˆåŠŸ';
                    result.className = 'result success';
                    logSuccess('API è¿æ¥æµ‹è¯•é€šè¿‡');
                } else {
                    result.innerHTML = `âŒ API è¿æ¥å¤±è´¥: ${response.status} ${response.statusText}`;
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = `âŒ API è¿æ¥å¼‚å¸¸: ${error.message}`;
                result.className = 'result error';
                logError(`API è¿æ¥å¼‚å¸¸: ${error.message}`);
            }
        }

        async function testGetCampaigns() {
            const result = document.getElementById('apiResult');
            result.innerHTML = 'æ­£åœ¨è·å–è·‘å›¢åˆ—è¡¨...';
            
            try {
                const response = await fetch('/api/campaigns');
                const data = await response.json();
                
                result.innerHTML = `âœ… è·‘å›¢åˆ—è¡¨è·å–æˆåŠŸ:\n${JSON.stringify(data, null, 2)}`;
                result.className = 'result success';
                logSuccess('è·‘å›¢åˆ—è¡¨è·å–æˆåŠŸ');
            } catch (error) {
                result.innerHTML = `âŒ è·å–è·‘å›¢åˆ—è¡¨å¤±è´¥: ${error.message}`;
                result.className = 'result error';
                logError(`è·å–è·‘å›¢åˆ—è¡¨å¤±è´¥: ${error.message}`);
            }
        }

        async function testCreateCampaign() {
            const result = document.getElementById('apiResult');
            const campaignName = `debug_test_${Date.now()}`;
            result.innerHTML = `æ­£åœ¨åˆ›å»ºæµ‹è¯•è·‘å›¢: ${campaignName}...`;
            
            try {
                const response = await fetch('/api/campaigns', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: campaignName })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    result.innerHTML = `âœ… è·‘å›¢åˆ›å»ºæˆåŠŸ: ${campaignName}\n${JSON.stringify(data, null, 2)}`;
                    result.className = 'result success';
                    logSuccess(`è·‘å›¢åˆ›å»ºæˆåŠŸ: ${campaignName}`);
                } else {
                    result.innerHTML = `âŒ è·‘å›¢åˆ›å»ºå¤±è´¥: ${data.error}`;
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = `âŒ åˆ›å»ºè·‘å›¢å¼‚å¸¸: ${error.message}`;
                result.className = 'result error';
                logError(`åˆ›å»ºè·‘å›¢å¼‚å¸¸: ${error.message}`);
            }
        }

        async function testDeleteCampaign() {
            const result = document.getElementById('apiResult');
            result.innerHTML = 'æ­£åœ¨æŸ¥æ‰¾å¹¶åˆ é™¤æµ‹è¯•è·‘å›¢...';
            
            try {
                // å…ˆè·å–è·‘å›¢åˆ—è¡¨
                const listResponse = await fetch('/api/campaigns');
                const listData = await listResponse.json();
                
                // æ‰¾åˆ°æµ‹è¯•è·‘å›¢
                const testCampaigns = listData.campaigns.filter(name => name.startsWith('debug_test_'));
                
                if (testCampaigns.length === 0) {
                    result.innerHTML = 'âš ï¸ æ²¡æœ‰æ‰¾åˆ°æµ‹è¯•è·‘å›¢';
                    result.className = 'result';
                    return;
                }
                
                // åˆ é™¤ç¬¬ä¸€ä¸ªæµ‹è¯•è·‘å›¢
                const campaignToDelete = testCampaigns[0];
                const deleteResponse = await fetch('/api/campaigns', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: campaignToDelete })
                });
                
                const deleteData = await deleteResponse.json();
                
                if (deleteData.success) {
                    result.innerHTML = `âœ… è·‘å›¢åˆ é™¤æˆåŠŸ: ${campaignToDelete}\n${JSON.stringify(deleteData, null, 2)}`;
                    result.className = 'result success';
                    logSuccess(`è·‘å›¢åˆ é™¤æˆåŠŸ: ${campaignToDelete}`);
                } else {
                    result.innerHTML = `âŒ è·‘å›¢åˆ é™¤å¤±è´¥: ${deleteData.error}`;
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = `âŒ åˆ é™¤è·‘å›¢å¼‚å¸¸: ${error.message}`;
                result.className = 'result error';
                logError(`åˆ é™¤è·‘å›¢å¼‚å¸¸: ${error.message}`);
            }
        }

        // JavaScript åŠŸèƒ½æµ‹è¯•
        function testBasicJS() {
            const result = document.getElementById('jsResult');
            
            try {
                // æµ‹è¯•åŸºæœ¬åŠŸèƒ½
                const testObj = { test: 'value' };
                const testArray = [1, 2, 3];
                const testString = 'Hello World';
                
                result.innerHTML = `âœ… åŸºç¡€ JavaScript åŠŸèƒ½æ­£å¸¸:
å¯¹è±¡: ${JSON.stringify(testObj)}
æ•°ç»„: ${JSON.stringify(testArray)}
å­—ç¬¦ä¸²: ${testString}
å½“å‰æ—¶é—´: ${new Date().toLocaleString()}`;
                result.className = 'result success';
                logSuccess('åŸºç¡€ JavaScript æµ‹è¯•é€šè¿‡');
            } catch (error) {
                result.innerHTML = `âŒ åŸºç¡€ JavaScript æµ‹è¯•å¤±è´¥: ${error.message}`;
                result.className = 'result error';
                logError(`åŸºç¡€ JavaScript æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        function testFetchAPI() {
            const result = document.getElementById('jsResult');
            
            if (typeof fetch === 'undefined') {
                result.innerHTML = 'âŒ Fetch API ä¸å¯ç”¨';
                result.className = 'result error';
                logError('Fetch API ä¸å¯ç”¨');
                return;
            }
            
            result.innerHTML = 'âœ… Fetch API å¯ç”¨';
            result.className = 'result success';
            logSuccess('Fetch API æµ‹è¯•é€šè¿‡');
        }

        function testDOMManipulation() {
            const result = document.getElementById('jsResult');
            
            try {
                // æµ‹è¯• DOM æ“ä½œ
                const testDiv = document.createElement('div');
                testDiv.innerHTML = 'Test Element';
                testDiv.style.color = 'blue';
                
                // æµ‹è¯•äº‹ä»¶ç›‘å¬
                let eventWorking = false;
                testDiv.addEventListener('click', () => {
                    eventWorking = true;
                });
                
                // æ¨¡æ‹Ÿç‚¹å‡»
                testDiv.click();
                
                result.innerHTML = `âœ… DOM æ“ä½œåŠŸèƒ½æ­£å¸¸:
å…ƒç´ åˆ›å»º: âœ…
æ ·å¼è®¾ç½®: âœ…
äº‹ä»¶ç›‘å¬: ${eventWorking ? 'âœ…' : 'âŒ'}
querySelector: ${document.querySelector ? 'âœ…' : 'âŒ'}
addEventListener: ${document.addEventListener ? 'âœ…' : 'âŒ'}`;
                result.className = 'result success';
                logSuccess('DOM æ“ä½œæµ‹è¯•é€šè¿‡');
            } catch (error) {
                result.innerHTML = `âŒ DOM æ“ä½œæµ‹è¯•å¤±è´¥: ${error.message}`;
                result.className = 'result error';
                logError(`DOM æ“ä½œæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            logSuccess('é¡µé¢åŠ è½½å®Œæˆ');
            testBasicJS();
            testFetchAPI();
        });
    </script>
</body>
</html>